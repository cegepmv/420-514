<!DOCTYPE html>
<html lang="fr-ca" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head><script src="/420-514/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=420-514/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.148.2">
    <meta name="generator" content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862">
    <meta name="description" content="PrÃ©requis &amp; mise en place mkdir http-lab &amp;&amp; cd http-lab npm init -y npm i expressCrÃ©e server.js :
// server.js const express = require(&#39;express&#39;); const app = express(); app.use(express.json()); // ===== Middleware de log (ligne de requÃªte) ===== app.use((req, res, next) =&gt; { console.log(`${req.method} ${req.url}`); next(); }); // ===== Mock &#34;DB&#34; en mÃ©moire ===== let nextId = 3; let users = [ { id: 1, name: &#39;Alice&#39;, email: &#39;alice@example.com&#39;, role: &#39;student&#39; }, { id: 2, name: &#39;Bob&#39;, email: &#39;bob@example.com&#39;, role: &#39;student&#39; }, ]; // ===== Middlewares utilitaires ===== function findUser(req, res, next) { const id = Number(req.params.id); const user = users.find(u =&gt; u.id === id); if (!user) return res.status(404).json({ error: &#39;Utilisateur non trouvÃ©&#39; }); req.user = user; next(); } function validateUserPayload(req, res, next) { const { name, email, role } = req.body ?? {}; if (!name || !email) return res.status(400).json({ error: &#39;name et email sont requis&#39; }); if (role &amp;&amp; ![&#39;student&#39;, &#39;admin&#39;, &#39;teacher&#39;].includes(role)) { return res.status(400).json({ error: &#34;role doit Ãªtre &#39;student&#39; | &#39;admin&#39; | &#39;teacher&#39;&#34; }); } next(); } // ===== Routes de dÃ©monstration HTTP ===== // GET simple &#43; en-tÃªte custom app.get(&#39;/hello&#39;, (req, res) =&gt; { res.set(&#39;X-Server&#39;, &#39;MV-Express&#39;); // en-tÃªte rÃ©ponse res.status(200).send(&#39;Bonjour ðŸ‘‹&#39;); }); // HEAD : renvoie seulement les en-tÃªtes app.head(&#39;/ping&#39;, (req, res) =&gt; res.status(200).end()); // Codes de statut Ã  la demande (ex: /status/404) app.get(&#39;/status/:code&#39;, (req, res) =&gt; res.sendStatus(Number(req.params.code))); // ===== Ressource /users (CRUD) ===== // Liste &#43; filtre ?q= app.get(&#39;/users&#39;, (req, res) =&gt; { const q = (req.query.q || &#39;&#39;).toLowerCase(); const result = q ? users.filter(u =&gt; [u.name, u.email, u.role].some(v =&gt; String(v).toLowerCase().includes(q))) : users; res.status(200).json({ count: result.length, data: result }); }); // Lire par id app.get(&#39;/users/:id&#39;, findUser, (req, res) =&gt; res.status(200).json(req.user)); // CrÃ©er app.post(&#39;/users&#39;, validateUserPayload, (req, res) =&gt; { const { name, email, role = &#39;student&#39; } = req.body; if (users.some(u =&gt; u.email.toLowerCase() === email.toLowerCase())) { return res.status(409).json({ error: &#39;Email dÃ©jÃ  utilisÃ©&#39; }); } const user = { id: nextId&#43;&#43;, name, email, role }; users.push(user); res.status(201).location(`/users/${user.id}`).json(user); }); // Remplacer (PUT) app.put(&#39;/users/:id&#39;, findUser, validateUserPayload, (req, res) =&gt; { const { name, email, role = &#39;student&#39; } = req.body; if (users.some(u =&gt; u.email.toLowerCase() === email.toLowerCase() &amp;&amp; u.id !== req.user.id)) { return res.status(409).json({ error: &#39;Email dÃ©jÃ  utilisÃ©&#39; }); } Object.assign(req.user, { name, email, role }); res.status(200).json(req.user); }); // Modifier partiel (PATCH) app.patch(&#39;/users/:id&#39;, findUser, (req, res) =&gt; { const allowed = [&#39;name&#39;, &#39;email&#39;, &#39;role&#39;]; const payload = Object.fromEntries( Object.entries(req.body ?? {}).filter(([k]) =&gt; allowed.includes(k)) ); if (&#39;role&#39; in payload &amp;&amp; ![&#39;student&#39;, &#39;admin&#39;, &#39;teacher&#39;].includes(payload.role)) { return res.status(400).json({ error: &#34;role doit Ãªtre &#39;student&#39; | &#39;admin&#39; | &#39;teacher&#39;&#34; }); } if (&#39;email&#39; in payload &amp;&amp; users.some(u =&gt; u.email.toLowerCase() === payload.email.toLowerCase() &amp;&amp; u.id !== req.user.id)) { return res.status(409).json({ error: &#39;Email dÃ©jÃ  utilisÃ©&#39; }); } Object.assign(req.user, payload); res.status(200).json(req.user); }); // Supprimer app.delete(&#39;/users/:id&#39;, findUser, (req, res) =&gt; { users = users.filter(u =&gt; u.id !== req.user.id); res.status(204).send(); }); // Erreur volontaire app.get(&#39;/boom&#39;, (req, res) =&gt; { throw new Error(&#39;Oups ðŸ’¥&#39;); }); // Handler dâ€™erreurs (toujours Ã  la fin) app.use((err, req, res, next) =&gt; { console.error(err.stack); res.status(500).json({ error: &#39;Erreur interne&#39;, detail: err.message }); }); app.listen(3000, () =&gt; console.log(&#39;Serveur prÃªt : http://localhost:3000&#39;));Lancer :">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="ðŸ§ª Laboratoire : RequÃªtes HTTP & Ã©changes de donnÃ©es avec Node.js/Express :: Collecte et interprÃ©tation de donnÃ©es">
    <meta name="twitter:description" content="PrÃ©requis &amp; mise en place mkdir http-lab &amp;&amp; cd http-lab npm init -y npm i expressCrÃ©e server.js :
// server.js const express = require(&#39;express&#39;); const app = express(); app.use(express.json()); // ===== Middleware de log (ligne de requÃªte) ===== app.use((req, res, next) =&gt; { console.log(`${req.method} ${req.url}`); next(); }); // ===== Mock &#34;DB&#34; en mÃ©moire ===== let nextId = 3; let users = [ { id: 1, name: &#39;Alice&#39;, email: &#39;alice@example.com&#39;, role: &#39;student&#39; }, { id: 2, name: &#39;Bob&#39;, email: &#39;bob@example.com&#39;, role: &#39;student&#39; }, ]; // ===== Middlewares utilitaires ===== function findUser(req, res, next) { const id = Number(req.params.id); const user = users.find(u =&gt; u.id === id); if (!user) return res.status(404).json({ error: &#39;Utilisateur non trouvÃ©&#39; }); req.user = user; next(); } function validateUserPayload(req, res, next) { const { name, email, role } = req.body ?? {}; if (!name || !email) return res.status(400).json({ error: &#39;name et email sont requis&#39; }); if (role &amp;&amp; ![&#39;student&#39;, &#39;admin&#39;, &#39;teacher&#39;].includes(role)) { return res.status(400).json({ error: &#34;role doit Ãªtre &#39;student&#39; | &#39;admin&#39; | &#39;teacher&#39;&#34; }); } next(); } // ===== Routes de dÃ©monstration HTTP ===== // GET simple &#43; en-tÃªte custom app.get(&#39;/hello&#39;, (req, res) =&gt; { res.set(&#39;X-Server&#39;, &#39;MV-Express&#39;); // en-tÃªte rÃ©ponse res.status(200).send(&#39;Bonjour ðŸ‘‹&#39;); }); // HEAD : renvoie seulement les en-tÃªtes app.head(&#39;/ping&#39;, (req, res) =&gt; res.status(200).end()); // Codes de statut Ã  la demande (ex: /status/404) app.get(&#39;/status/:code&#39;, (req, res) =&gt; res.sendStatus(Number(req.params.code))); // ===== Ressource /users (CRUD) ===== // Liste &#43; filtre ?q= app.get(&#39;/users&#39;, (req, res) =&gt; { const q = (req.query.q || &#39;&#39;).toLowerCase(); const result = q ? users.filter(u =&gt; [u.name, u.email, u.role].some(v =&gt; String(v).toLowerCase().includes(q))) : users; res.status(200).json({ count: result.length, data: result }); }); // Lire par id app.get(&#39;/users/:id&#39;, findUser, (req, res) =&gt; res.status(200).json(req.user)); // CrÃ©er app.post(&#39;/users&#39;, validateUserPayload, (req, res) =&gt; { const { name, email, role = &#39;student&#39; } = req.body; if (users.some(u =&gt; u.email.toLowerCase() === email.toLowerCase())) { return res.status(409).json({ error: &#39;Email dÃ©jÃ  utilisÃ©&#39; }); } const user = { id: nextId&#43;&#43;, name, email, role }; users.push(user); res.status(201).location(`/users/${user.id}`).json(user); }); // Remplacer (PUT) app.put(&#39;/users/:id&#39;, findUser, validateUserPayload, (req, res) =&gt; { const { name, email, role = &#39;student&#39; } = req.body; if (users.some(u =&gt; u.email.toLowerCase() === email.toLowerCase() &amp;&amp; u.id !== req.user.id)) { return res.status(409).json({ error: &#39;Email dÃ©jÃ  utilisÃ©&#39; }); } Object.assign(req.user, { name, email, role }); res.status(200).json(req.user); }); // Modifier partiel (PATCH) app.patch(&#39;/users/:id&#39;, findUser, (req, res) =&gt; { const allowed = [&#39;name&#39;, &#39;email&#39;, &#39;role&#39;]; const payload = Object.fromEntries( Object.entries(req.body ?? {}).filter(([k]) =&gt; allowed.includes(k)) ); if (&#39;role&#39; in payload &amp;&amp; ![&#39;student&#39;, &#39;admin&#39;, &#39;teacher&#39;].includes(payload.role)) { return res.status(400).json({ error: &#34;role doit Ãªtre &#39;student&#39; | &#39;admin&#39; | &#39;teacher&#39;&#34; }); } if (&#39;email&#39; in payload &amp;&amp; users.some(u =&gt; u.email.toLowerCase() === payload.email.toLowerCase() &amp;&amp; u.id !== req.user.id)) { return res.status(409).json({ error: &#39;Email dÃ©jÃ  utilisÃ©&#39; }); } Object.assign(req.user, payload); res.status(200).json(req.user); }); // Supprimer app.delete(&#39;/users/:id&#39;, findUser, (req, res) =&gt; { users = users.filter(u =&gt; u.id !== req.user.id); res.status(204).send(); }); // Erreur volontaire app.get(&#39;/boom&#39;, (req, res) =&gt; { throw new Error(&#39;Oups ðŸ’¥&#39;); }); // Handler dâ€™erreurs (toujours Ã  la fin) app.use((err, req, res, next) =&gt; { console.error(err.stack); res.status(500).json({ error: &#39;Erreur interne&#39;, detail: err.message }); }); app.listen(3000, () =&gt; console.log(&#39;Serveur prÃªt : http://localhost:3000&#39;));Lancer :">
    <meta property="og:url" content="http://localhost:1313/420-514/httprequestdataformat/lab1/index.html">
    <meta property="og:site_name" content="Collecte et interprÃ©tation de donnÃ©es">
    <meta property="og:title" content="ðŸ§ª Laboratoire : RequÃªtes HTTP & Ã©changes de donnÃ©es avec Node.js/Express :: Collecte et interprÃ©tation de donnÃ©es">
    <meta property="og:description" content="PrÃ©requis &amp; mise en place mkdir http-lab &amp;&amp; cd http-lab npm init -y npm i expressCrÃ©e server.js :
// server.js const express = require(&#39;express&#39;); const app = express(); app.use(express.json()); // ===== Middleware de log (ligne de requÃªte) ===== app.use((req, res, next) =&gt; { console.log(`${req.method} ${req.url}`); next(); }); // ===== Mock &#34;DB&#34; en mÃ©moire ===== let nextId = 3; let users = [ { id: 1, name: &#39;Alice&#39;, email: &#39;alice@example.com&#39;, role: &#39;student&#39; }, { id: 2, name: &#39;Bob&#39;, email: &#39;bob@example.com&#39;, role: &#39;student&#39; }, ]; // ===== Middlewares utilitaires ===== function findUser(req, res, next) { const id = Number(req.params.id); const user = users.find(u =&gt; u.id === id); if (!user) return res.status(404).json({ error: &#39;Utilisateur non trouvÃ©&#39; }); req.user = user; next(); } function validateUserPayload(req, res, next) { const { name, email, role } = req.body ?? {}; if (!name || !email) return res.status(400).json({ error: &#39;name et email sont requis&#39; }); if (role &amp;&amp; ![&#39;student&#39;, &#39;admin&#39;, &#39;teacher&#39;].includes(role)) { return res.status(400).json({ error: &#34;role doit Ãªtre &#39;student&#39; | &#39;admin&#39; | &#39;teacher&#39;&#34; }); } next(); } // ===== Routes de dÃ©monstration HTTP ===== // GET simple &#43; en-tÃªte custom app.get(&#39;/hello&#39;, (req, res) =&gt; { res.set(&#39;X-Server&#39;, &#39;MV-Express&#39;); // en-tÃªte rÃ©ponse res.status(200).send(&#39;Bonjour ðŸ‘‹&#39;); }); // HEAD : renvoie seulement les en-tÃªtes app.head(&#39;/ping&#39;, (req, res) =&gt; res.status(200).end()); // Codes de statut Ã  la demande (ex: /status/404) app.get(&#39;/status/:code&#39;, (req, res) =&gt; res.sendStatus(Number(req.params.code))); // ===== Ressource /users (CRUD) ===== // Liste &#43; filtre ?q= app.get(&#39;/users&#39;, (req, res) =&gt; { const q = (req.query.q || &#39;&#39;).toLowerCase(); const result = q ? users.filter(u =&gt; [u.name, u.email, u.role].some(v =&gt; String(v).toLowerCase().includes(q))) : users; res.status(200).json({ count: result.length, data: result }); }); // Lire par id app.get(&#39;/users/:id&#39;, findUser, (req, res) =&gt; res.status(200).json(req.user)); // CrÃ©er app.post(&#39;/users&#39;, validateUserPayload, (req, res) =&gt; { const { name, email, role = &#39;student&#39; } = req.body; if (users.some(u =&gt; u.email.toLowerCase() === email.toLowerCase())) { return res.status(409).json({ error: &#39;Email dÃ©jÃ  utilisÃ©&#39; }); } const user = { id: nextId&#43;&#43;, name, email, role }; users.push(user); res.status(201).location(`/users/${user.id}`).json(user); }); // Remplacer (PUT) app.put(&#39;/users/:id&#39;, findUser, validateUserPayload, (req, res) =&gt; { const { name, email, role = &#39;student&#39; } = req.body; if (users.some(u =&gt; u.email.toLowerCase() === email.toLowerCase() &amp;&amp; u.id !== req.user.id)) { return res.status(409).json({ error: &#39;Email dÃ©jÃ  utilisÃ©&#39; }); } Object.assign(req.user, { name, email, role }); res.status(200).json(req.user); }); // Modifier partiel (PATCH) app.patch(&#39;/users/:id&#39;, findUser, (req, res) =&gt; { const allowed = [&#39;name&#39;, &#39;email&#39;, &#39;role&#39;]; const payload = Object.fromEntries( Object.entries(req.body ?? {}).filter(([k]) =&gt; allowed.includes(k)) ); if (&#39;role&#39; in payload &amp;&amp; ![&#39;student&#39;, &#39;admin&#39;, &#39;teacher&#39;].includes(payload.role)) { return res.status(400).json({ error: &#34;role doit Ãªtre &#39;student&#39; | &#39;admin&#39; | &#39;teacher&#39;&#34; }); } if (&#39;email&#39; in payload &amp;&amp; users.some(u =&gt; u.email.toLowerCase() === payload.email.toLowerCase() &amp;&amp; u.id !== req.user.id)) { return res.status(409).json({ error: &#39;Email dÃ©jÃ  utilisÃ©&#39; }); } Object.assign(req.user, payload); res.status(200).json(req.user); }); // Supprimer app.delete(&#39;/users/:id&#39;, findUser, (req, res) =&gt; { users = users.filter(u =&gt; u.id !== req.user.id); res.status(204).send(); }); // Erreur volontaire app.get(&#39;/boom&#39;, (req, res) =&gt; { throw new Error(&#39;Oups ðŸ’¥&#39;); }); // Handler dâ€™erreurs (toujours Ã  la fin) app.use((err, req, res, next) =&gt; { console.error(err.stack); res.status(500).json({ error: &#39;Erreur interne&#39;, detail: err.message }); }); app.listen(3000, () =&gt; console.log(&#39;Serveur prÃªt : http://localhost:3000&#39;));Lancer :">
    <meta property="og:locale" content="fr_ca">
    <meta property="og:type" content="article">
    <meta property="article:section" content="RequÃªtes HTTP et format de donnÃ©es">
    <meta itemprop="name" content="ðŸ§ª Laboratoire : RequÃªtes HTTP & Ã©changes de donnÃ©es avec Node.js/Express :: Collecte et interprÃ©tation de donnÃ©es">
    <meta itemprop="description" content="PrÃ©requis &amp; mise en place mkdir http-lab &amp;&amp; cd http-lab npm init -y npm i expressCrÃ©e server.js :
// server.js const express = require(&#39;express&#39;); const app = express(); app.use(express.json()); // ===== Middleware de log (ligne de requÃªte) ===== app.use((req, res, next) =&gt; { console.log(`${req.method} ${req.url}`); next(); }); // ===== Mock &#34;DB&#34; en mÃ©moire ===== let nextId = 3; let users = [ { id: 1, name: &#39;Alice&#39;, email: &#39;alice@example.com&#39;, role: &#39;student&#39; }, { id: 2, name: &#39;Bob&#39;, email: &#39;bob@example.com&#39;, role: &#39;student&#39; }, ]; // ===== Middlewares utilitaires ===== function findUser(req, res, next) { const id = Number(req.params.id); const user = users.find(u =&gt; u.id === id); if (!user) return res.status(404).json({ error: &#39;Utilisateur non trouvÃ©&#39; }); req.user = user; next(); } function validateUserPayload(req, res, next) { const { name, email, role } = req.body ?? {}; if (!name || !email) return res.status(400).json({ error: &#39;name et email sont requis&#39; }); if (role &amp;&amp; ![&#39;student&#39;, &#39;admin&#39;, &#39;teacher&#39;].includes(role)) { return res.status(400).json({ error: &#34;role doit Ãªtre &#39;student&#39; | &#39;admin&#39; | &#39;teacher&#39;&#34; }); } next(); } // ===== Routes de dÃ©monstration HTTP ===== // GET simple &#43; en-tÃªte custom app.get(&#39;/hello&#39;, (req, res) =&gt; { res.set(&#39;X-Server&#39;, &#39;MV-Express&#39;); // en-tÃªte rÃ©ponse res.status(200).send(&#39;Bonjour ðŸ‘‹&#39;); }); // HEAD : renvoie seulement les en-tÃªtes app.head(&#39;/ping&#39;, (req, res) =&gt; res.status(200).end()); // Codes de statut Ã  la demande (ex: /status/404) app.get(&#39;/status/:code&#39;, (req, res) =&gt; res.sendStatus(Number(req.params.code))); // ===== Ressource /users (CRUD) ===== // Liste &#43; filtre ?q= app.get(&#39;/users&#39;, (req, res) =&gt; { const q = (req.query.q || &#39;&#39;).toLowerCase(); const result = q ? users.filter(u =&gt; [u.name, u.email, u.role].some(v =&gt; String(v).toLowerCase().includes(q))) : users; res.status(200).json({ count: result.length, data: result }); }); // Lire par id app.get(&#39;/users/:id&#39;, findUser, (req, res) =&gt; res.status(200).json(req.user)); // CrÃ©er app.post(&#39;/users&#39;, validateUserPayload, (req, res) =&gt; { const { name, email, role = &#39;student&#39; } = req.body; if (users.some(u =&gt; u.email.toLowerCase() === email.toLowerCase())) { return res.status(409).json({ error: &#39;Email dÃ©jÃ  utilisÃ©&#39; }); } const user = { id: nextId&#43;&#43;, name, email, role }; users.push(user); res.status(201).location(`/users/${user.id}`).json(user); }); // Remplacer (PUT) app.put(&#39;/users/:id&#39;, findUser, validateUserPayload, (req, res) =&gt; { const { name, email, role = &#39;student&#39; } = req.body; if (users.some(u =&gt; u.email.toLowerCase() === email.toLowerCase() &amp;&amp; u.id !== req.user.id)) { return res.status(409).json({ error: &#39;Email dÃ©jÃ  utilisÃ©&#39; }); } Object.assign(req.user, { name, email, role }); res.status(200).json(req.user); }); // Modifier partiel (PATCH) app.patch(&#39;/users/:id&#39;, findUser, (req, res) =&gt; { const allowed = [&#39;name&#39;, &#39;email&#39;, &#39;role&#39;]; const payload = Object.fromEntries( Object.entries(req.body ?? {}).filter(([k]) =&gt; allowed.includes(k)) ); if (&#39;role&#39; in payload &amp;&amp; ![&#39;student&#39;, &#39;admin&#39;, &#39;teacher&#39;].includes(payload.role)) { return res.status(400).json({ error: &#34;role doit Ãªtre &#39;student&#39; | &#39;admin&#39; | &#39;teacher&#39;&#34; }); } if (&#39;email&#39; in payload &amp;&amp; users.some(u =&gt; u.email.toLowerCase() === payload.email.toLowerCase() &amp;&amp; u.id !== req.user.id)) { return res.status(409).json({ error: &#39;Email dÃ©jÃ  utilisÃ©&#39; }); } Object.assign(req.user, payload); res.status(200).json(req.user); }); // Supprimer app.delete(&#39;/users/:id&#39;, findUser, (req, res) =&gt; { users = users.filter(u =&gt; u.id !== req.user.id); res.status(204).send(); }); // Erreur volontaire app.get(&#39;/boom&#39;, (req, res) =&gt; { throw new Error(&#39;Oups ðŸ’¥&#39;); }); // Handler dâ€™erreurs (toujours Ã  la fin) app.use((err, req, res, next) =&gt; { console.error(err.stack); res.status(500).json({ error: &#39;Erreur interne&#39;, detail: err.message }); }); app.listen(3000, () =&gt; console.log(&#39;Serveur prÃªt : http://localhost:3000&#39;));Lancer :">
    <meta itemprop="wordCount" content="1192">
    <title>ðŸ§ª Laboratoire : RequÃªtes HTTP &amp; Ã©changes de donnÃ©es avec Node.js/Express :: Collecte et interprÃ©tation de donnÃ©es</title><link rel="icon" href="/420-123/images/favicon.png" type="image/png">
    <link href="/420-514/css/auto-complete/auto-complete.min.css?1756903610" rel="stylesheet">
    <script src="/420-514/js/auto-complete/auto-complete.min.js?1756903610" defer></script>
    <script src="/420-514/js/search-lunr.js?1756903610" defer></script>
    <script src="/420-514/js/search.js?1756903610" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/420-514/searchindex.en.js?1756903610";
    </script>
    <script src="/420-514/js/lunr/lunr.min.js?1756903610" defer></script>
    <script src="/420-514/js/lunr/lunr.stemmer.support.min.js?1756903610" defer></script>
    <script src="/420-514/js/lunr/lunr.multi.min.js?1756903610" defer></script>
    <script src="/420-514/js/lunr/lunr.fr.min.js?1756903610" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['fr'];
    </script>
    <link href="/420-514/fonts/fontawesome/css/fontawesome-all.min.css?1756903610" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/420-514/fonts/fontawesome/css/fontawesome-all.min.css?1756903610" rel="stylesheet"></noscript>
    <link href="/420-514/css/perfect-scrollbar/perfect-scrollbar.min.css?1756903610" rel="stylesheet">
    <link href="/420-514/css/theme.css?1756903610" rel="stylesheet">
    <link href="/420-514/css/format-html.css?1756903610" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = ``;
      window.relearn.path='\/httprequestdataformat\/lab1\/index.html';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='http:\/\/localhost:1313\/420-514';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'green' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
  </head>
  <body class="mobile-support html" data-url="/420-514/httprequestdataformat/lab1/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/420-514/index.html"><span itemprop="name">Collecte et interprÃ©tation de donnÃ©es</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/420-514/httprequestdataformat/index.html"><span itemprop="name">RequÃªtes HTTP et format de donnÃ©es</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><span itemprop="name">ðŸ§ª Laboratoire : RequÃªtes HTTP &amp; Ã©changes de donnÃ©es avec Node.js/Express</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable httprequestdataformat" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="-laboratoire--requÃªtes-http--Ã©changes-de-donnÃ©es-avec-nodejsexpress">ðŸ§ª Laboratoire : RequÃªtes HTTP &amp; Ã©changes de donnÃ©es avec Node.js/Express</h1>

<h2 id="prÃ©requis--mise-en-place">PrÃ©requis &amp; mise en place</h2>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir http-lab <span style="color:#f92672">&amp;&amp;</span> cd http-lab
</span></span><span style="display:flex;"><span>npm init -y
</span></span><span style="display:flex;"><span>npm i express</span></span></code></pre></div>
<p>CrÃ©e <strong>server.js</strong> :</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// server.js
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">express</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;express&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">app</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">express</span>.<span style="color:#a6e22e">json</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ===== Middleware de log (ligne de requÃªte) =====
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>((<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">method</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">url</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ===== Mock &#34;DB&#34; en mÃ©moire =====
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">nextId</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">users</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Alice&#39;</span>, <span style="color:#a6e22e">email</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;alice@example.com&#39;</span>, <span style="color:#a6e22e">role</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;student&#39;</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Bob&#39;</span>,   <span style="color:#a6e22e">email</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;bob@example.com&#39;</span>,   <span style="color:#a6e22e">role</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;student&#39;</span> },
</span></span><span style="display:flex;"><span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ===== Middlewares utilitaires =====
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">findUser</span>(<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> Number(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">params</span>.<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">find</span>(<span style="color:#a6e22e">u</span> =&gt; <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">user</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">404</span>).<span style="color:#a6e22e">json</span>({ <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Utilisateur non trouvÃ©&#39;</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">user</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">validateUserPayload</span>(<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">email</span>, <span style="color:#a6e22e">role</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span> <span style="color:#f92672">??</span> {};
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">email</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">400</span>).<span style="color:#a6e22e">json</span>({ <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;name et email sont requis&#39;</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">role</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>[<span style="color:#e6db74">&#39;student&#39;</span>, <span style="color:#e6db74">&#39;admin&#39;</span>, <span style="color:#e6db74">&#39;teacher&#39;</span>].<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">role</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">400</span>).<span style="color:#a6e22e">json</span>({ <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;role doit Ãªtre &#39;student&#39; | &#39;admin&#39; | &#39;teacher&#39;&#34;</span> });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ===== Routes de dÃ©monstration HTTP =====
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// GET simple + en-tÃªte custom
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/hello&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#39;X-Server&#39;</span>, <span style="color:#e6db74">&#39;MV-Express&#39;</span>);    <span style="color:#75715e">// en-tÃªte rÃ©ponse
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>).<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;Bonjour ðŸ‘‹&#39;</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// HEAD : renvoie seulement les en-tÃªtes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">head</span>(<span style="color:#e6db74">&#39;/ping&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>).<span style="color:#a6e22e">end</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Codes de statut Ã  la demande (ex: /status/404)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/status/:code&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">sendStatus</span>(Number(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">params</span>.<span style="color:#a6e22e">code</span>)));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ===== Ressource /users (CRUD) =====
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Liste + filtre ?q=
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/users&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">q</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">query</span>.<span style="color:#a6e22e">q</span> <span style="color:#f92672">||</span> <span style="color:#e6db74">&#39;&#39;</span>).<span style="color:#a6e22e">toLowerCase</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">result</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">q</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">?</span> <span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">u</span> =&gt; [<span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">email</span>, <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">role</span>].<span style="color:#a6e22e">some</span>(<span style="color:#a6e22e">v</span> =&gt; String(<span style="color:#a6e22e">v</span>).<span style="color:#a6e22e">toLowerCase</span>().<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">q</span>)))
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">:</span> <span style="color:#a6e22e">users</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>).<span style="color:#a6e22e">json</span>({ <span style="color:#a6e22e">count</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">length</span>, <span style="color:#a6e22e">data</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">result</span> });
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Lire par id
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/users/:id&#39;</span>, <span style="color:#a6e22e">findUser</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>).<span style="color:#a6e22e">json</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">user</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// CrÃ©er
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;/users&#39;</span>, <span style="color:#a6e22e">validateUserPayload</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">email</span>, <span style="color:#a6e22e">role</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;student&#39;</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">some</span>(<span style="color:#a6e22e">u</span> =&gt; <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">email</span>.<span style="color:#a6e22e">toLowerCase</span>() <span style="color:#f92672">===</span> <span style="color:#a6e22e">email</span>.<span style="color:#a6e22e">toLowerCase</span>())) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">409</span>).<span style="color:#a6e22e">json</span>({ <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Email dÃ©jÃ  utilisÃ©&#39;</span> });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> { <span style="color:#a6e22e">id</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">nextId</span><span style="color:#f92672">++</span>, <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">email</span>, <span style="color:#a6e22e">role</span> };
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">user</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">201</span>).<span style="color:#a6e22e">location</span>(<span style="color:#e6db74">`/users/</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">id</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>).<span style="color:#a6e22e">json</span>(<span style="color:#a6e22e">user</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Remplacer (PUT)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">put</span>(<span style="color:#e6db74">&#39;/users/:id&#39;</span>, <span style="color:#a6e22e">findUser</span>, <span style="color:#a6e22e">validateUserPayload</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">email</span>, <span style="color:#a6e22e">role</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;student&#39;</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">some</span>(<span style="color:#a6e22e">u</span> =&gt; <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">email</span>.<span style="color:#a6e22e">toLowerCase</span>() <span style="color:#f92672">===</span> <span style="color:#a6e22e">email</span>.<span style="color:#a6e22e">toLowerCase</span>() <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">id</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">409</span>).<span style="color:#a6e22e">json</span>({ <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Email dÃ©jÃ  utilisÃ©&#39;</span> });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  Object.<span style="color:#a6e22e">assign</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">user</span>, { <span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">email</span>, <span style="color:#a6e22e">role</span> });
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>).<span style="color:#a6e22e">json</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">user</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Modifier partiel (PATCH)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">patch</span>(<span style="color:#e6db74">&#39;/users/:id&#39;</span>, <span style="color:#a6e22e">findUser</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">allowed</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;name&#39;</span>, <span style="color:#e6db74">&#39;email&#39;</span>, <span style="color:#e6db74">&#39;role&#39;</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">payload</span> <span style="color:#f92672">=</span> Object.<span style="color:#a6e22e">fromEntries</span>(
</span></span><span style="display:flex;"><span>    Object.<span style="color:#a6e22e">entries</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span> <span style="color:#f92672">??</span> {}).<span style="color:#a6e22e">filter</span>(([<span style="color:#a6e22e">k</span>]) =&gt; <span style="color:#a6e22e">allowed</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">k</span>))
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#39;role&#39;</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">payload</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>[<span style="color:#e6db74">&#39;student&#39;</span>, <span style="color:#e6db74">&#39;admin&#39;</span>, <span style="color:#e6db74">&#39;teacher&#39;</span>].<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">payload</span>.<span style="color:#a6e22e">role</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">400</span>).<span style="color:#a6e22e">json</span>({ <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;role doit Ãªtre &#39;student&#39; | &#39;admin&#39; | &#39;teacher&#39;&#34;</span> });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#e6db74">&#39;email&#39;</span> <span style="color:#66d9ef">in</span> <span style="color:#a6e22e">payload</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">some</span>(<span style="color:#a6e22e">u</span> =&gt; <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">email</span>.<span style="color:#a6e22e">toLowerCase</span>() <span style="color:#f92672">===</span> <span style="color:#a6e22e">payload</span>.<span style="color:#a6e22e">email</span>.<span style="color:#a6e22e">toLowerCase</span>() <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">id</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">409</span>).<span style="color:#a6e22e">json</span>({ <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Email dÃ©jÃ  utilisÃ©&#39;</span> });
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  Object.<span style="color:#a6e22e">assign</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">user</span>, <span style="color:#a6e22e">payload</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">200</span>).<span style="color:#a6e22e">json</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">user</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Supprimer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#66d9ef">delete</span>(<span style="color:#e6db74">&#39;/users/:id&#39;</span>, <span style="color:#a6e22e">findUser</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">users</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">users</span>.<span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">u</span> =&gt; <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">!==</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">id</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">204</span>).<span style="color:#a6e22e">send</span>();
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Erreur volontaire
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/boom&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; { <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;Oups ðŸ’¥&#39;</span>); });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Handler dâ€™erreurs (toujours Ã  la fin)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>((<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">stack</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">500</span>).<span style="color:#a6e22e">json</span>({ <span style="color:#a6e22e">error</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Erreur interne&#39;</span>, <span style="color:#a6e22e">detail</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">message</span> });
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">listen</span>(<span style="color:#ae81ff">3000</span>, () =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Serveur prÃªt : http://localhost:3000&#39;</span>));</span></span></code></pre></div>
<p>Lancer :</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>node server.js</span></span></code></pre></div>
<hr>
<h2 id="-partie-a--explorer-avec-curl">ðŸ§­ Partie A â€” Explorer avec <strong>curl</strong></h2>
<blockquote>
<p>Astuce : ajoute <code>-i</code> pour voir les <strong>en-tÃªtes</strong> de rÃ©ponse, <code>-s</code> pour silencieux, et <code>| jq</code> pour formater le JSON.</p></blockquote>
<table>
  <thead>
      <tr>
          <th>Commande</th>
          <th>MÃ©thode</th>
          <th>Usage</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>curl http://.../users</code></td>
          <td>GET</td>
          <td>RÃ©cupÃ©rer tous les utilisateurs</td>
      </tr>
      <tr>
          <td><code>curl &quot;http://.../users?q=nom&quot;</code></td>
          <td>GET</td>
          <td>Recherche par query string</td>
      </tr>
      <tr>
          <td><code>curl -X POST -d ...</code></td>
          <td>POST</td>
          <td>CrÃ©er un utilisateur</td>
      </tr>
      <tr>
          <td><code>curl http://.../users/1</code></td>
          <td>GET</td>
          <td>Lire un utilisateur</td>
      </tr>
      <tr>
          <td><code>curl -X PUT -d ...</code></td>
          <td>PUT</td>
          <td>Remplacer entiÃ¨rement un utilisateur</td>
      </tr>
      <tr>
          <td><code>curl -X PATCH -d ...</code></td>
          <td>PATCH</td>
          <td>Modifier partiellement</td>
      </tr>
      <tr>
          <td><code>curl -X DELETE ...</code></td>
          <td>DELETE</td>
          <td>Supprimer un utilisateur</td>
      </tr>
      <tr>
          <td><code>curl -i -X POST ... (conflit)</code></td>
          <td>POST</td>
          <td>DÃ©montrer les erreurs et codes 400/409</td>
      </tr>
  </tbody>
</table>
<ol>
<li><strong>GET</strong> <code>/hello</code></li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -i http://localhost:3000/hello</span></span></code></pre></div>
<p>â†’ Observe statut <strong>200</strong>, en-tÃªte custom <code>X-Server</code>, corps texte.</p>
<ol start="2">
<li><strong>HEAD</strong> <code>/ping</code></li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -I http://localhost:3000/ping</span></span></code></pre></div>
<p>â†’ En-tÃªtes seulement (pas de corps).</p>
<ol start="3">
<li><strong>GET</strong> <code>/users</code> (liste)</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -s http://localhost:3000/users | jq</span></span></code></pre></div>
<ol start="4">
<li><strong>GET</strong> <code>/users?q=alice</code> (filtre)</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -s <span style="color:#e6db74">&#34;http://localhost:3000/users?q=alice&#34;</span> | jq</span></span></code></pre></div>
<ol start="5">
<li><strong>POST</strong> <code>/users</code> (crÃ©ation)</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -i -H <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -d <span style="color:#e6db74">&#39;{&#34;name&#34;:&#34;Chloe&#34;,&#34;email&#34;:&#34;chloe@example.com&#34;,&#34;role&#34;:&#34;teacher&#34;}&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  http://localhost:3000/users</span></span></code></pre></div>
<p>â†’ Attends <strong>201 Created</strong> + en-tÃªte <strong>Location</strong>.</p>
<ol start="6">
<li><strong>GET</strong> <code>/users/1</code> (lecture)</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -s http://localhost:3000/users/1 | jq</span></span></code></pre></div>
<ol start="7">
<li><strong>PUT</strong> <code>/users/1</code> (remplacement)</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -s -X PUT -H <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -d <span style="color:#e6db74">&#39;{&#34;name&#34;:&#34;Alice Doe&#34;,&#34;email&#34;:&#34;alice.d@example.com&#34;,&#34;role&#34;:&#34;student&#34;}&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  http://localhost:3000/users/1 | jq</span></span></code></pre></div>
<ol start="8">
<li><strong>PATCH</strong> <code>/users/1</code> (modif partielle)</li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -s -X PATCH -H <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -d <span style="color:#e6db74">&#39;{&#34;role&#34;:&#34;admin&#34;}&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  http://localhost:3000/users/1 | jq</span></span></code></pre></div>
<ol start="9">
<li><strong>DELETE</strong> <code>/users/1</code></li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -i -X DELETE http://localhost:3000/users/1</span></span></code></pre></div>
<p>â†’ Attends <strong>204 No Content</strong>.</p>
<ol start="10">
<li><strong>Erreurs &amp; statuts</strong></li>
</ol>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -i http://localhost:3000/status/404
</span></span><span style="display:flex;"><span>curl -i http://localhost:3000/boom
</span></span><span style="display:flex;"><span>curl -i -X POST -H <span style="color:#e6db74">&#34;Content-Type: application/json&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -d <span style="color:#e6db74">&#39;{&#34;name&#34;:&#34;Dup&#34;,&#34;email&#34;:&#34;alice@example.com&#34;}&#39;</span> http://localhost:3000/users</span></span></code></pre></div>
<p>â†’ Observe <strong>404</strong>, <strong>500</strong>, <strong>409</strong>.</p>
<p>RÃ©sumÃ© des rÃ©sultats :</p>
<table>
  <thead>
      <tr>
          <th>#</th>
          <th>Commande <code>curl</code></th>
          <th>Code HTTP attendu</th>
          <th>RÃ©ponse JSON (ou texte) observÃ©e</th>
          <th></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td><code>curl -i http://localhost:3000/hello</code></td>
          <td>200 OK</td>
          <td>Corps texte : <code>Bonjour ðŸ‘‹</code> + en-tÃªte <code>X-Server</code></td>
          <td></td>
      </tr>
      <tr>
          <td>2</td>
          <td><code>curl -I http://localhost:3000/ping</code></td>
          <td>200 OK</td>
          <td>Aucun corps, uniquement les en-tÃªtes</td>
          <td></td>
      </tr>
      <tr>
          <td>3</td>
          <td>`curl -s <a href="http://localhost:3000/users" rel="external" target="_blank">http://localhost:3000/users</a></td>
          <td>jq`</td>
          <td>200 OK</td>
          <td>Liste complÃ¨te des utilisateurs (<code>count</code>, <code>data: [...]</code>)</td>
      </tr>
      <tr>
          <td>4</td>
          <td>`curl -s &ldquo;<a href="http://localhost:3000/users?q=alice" rel="external" target="_blank">http://localhost:3000/users?q=alice</a>&rdquo;</td>
          <td>jq`</td>
          <td>200 OK</td>
          <td>RÃ©sultat filtrÃ© par le paramÃ¨tre <code>q</code></td>
      </tr>
      <tr>
          <td>5</td>
          <td><code>curl -i -H &quot;Content-Type: application/json&quot; -d '{&quot;name&quot;:&quot;Chloe&quot;,&quot;email&quot;:&quot;chloe@example.com&quot;}' http://localhost:3000/users</code></td>
          <td>201 Created</td>
          <td>Objet utilisateur crÃ©Ã© + en-tÃªte <code>Location</code></td>
          <td></td>
      </tr>
      <tr>
          <td>6</td>
          <td>`curl -s <a href="http://localhost:3000/users/1" rel="external" target="_blank">http://localhost:3000/users/1</a></td>
          <td>jq`</td>
          <td>200 OK</td>
          <td>DÃ©tails de lâ€™utilisateur avec <code>id=1</code></td>
      </tr>
      <tr>
          <td>7</td>
          <td>`curl -s -X PUT -H &ldquo;Content-Type: application/json&rdquo; -d &lsquo;{&ldquo;name&rdquo;:&ldquo;Alice Doe&rdquo;,&ldquo;email&rdquo;:&quot;<a href="mailto:alice.d@example.com" rel="external" target="_blank">alice.d@example.com</a>&quot;}&rsquo; <a href="http://localhost:3000/users/1" rel="external" target="_blank">http://localhost:3000/users/1</a></td>
          <td>jq`</td>
          <td>200 OK</td>
          <td>Utilisateur remplacÃ© par les nouvelles donnÃ©es</td>
      </tr>
      <tr>
          <td>8</td>
          <td>`curl -s -X PATCH -H &ldquo;Content-Type: application/json&rdquo; -d &lsquo;{&ldquo;role&rdquo;:&ldquo;admin&rdquo;}&rsquo; <a href="http://localhost:3000/users/1" rel="external" target="_blank">http://localhost:3000/users/1</a></td>
          <td>jq`</td>
          <td>200 OK</td>
          <td>Champ <code>role</code> modifiÃ©</td>
      </tr>
      <tr>
          <td>9</td>
          <td><code>curl -i -X DELETE http://localhost:3000/users/1</code></td>
          <td>204 No Content</td>
          <td>Aucun corps dans la rÃ©ponse</td>
          <td></td>
      </tr>
      <tr>
          <td>10</td>
          <td><code>curl -i http://localhost:3000/status/404</code></td>
          <td>404 Not Found</td>
          <td>JSON ou message dâ€™erreur</td>
          <td></td>
      </tr>
      <tr>
          <td>11</td>
          <td><code>curl -i http://localhost:3000/boom</code></td>
          <td>500 Server Error</td>
          <td>JSON <code>{ &quot;error&quot;: &quot;Erreur interne&quot;, ... }</code></td>
          <td></td>
      </tr>
      <tr>
          <td>12</td>
          <td><code>curl -i -X POST -H &quot;Content-Type: application/json&quot; -d '{&quot;name&quot;:&quot;Dup&quot;,&quot;email&quot;:&quot;alice@example.com&quot;}' http://localhost:3000/users</code></td>
          <td>409 Conflict</td>
          <td>JSON <code>{ &quot;error&quot;: &quot;Email dÃ©jÃ  utilisÃ©&quot; }</code></td>
          <td></td>
      </tr>
  </tbody>
</table>
<h2 id="-partie-b--scÃ©nario-postman">ðŸ§­ Partie B â€” ScÃ©nario <strong>Postman</strong></h2>
<ol>
<li>
<p><strong>Environnement</strong> : <code>baseUrl = http://localhost:3000</code>.</p>
</li>
<li>
<p><strong>Collection</strong> Â« Users API (Local) Â» avec ces requÃªtes :</p>
<ul>
<li><code>GET {{baseUrl}}/users</code> â€” tests : 200, JSON, <code>{count,data}</code>.</li>
<li><code>POST {{baseUrl}}/users</code> â€” Body JSON ; <strong>Pre-request</strong> <code>pm.variables.set(&quot;rand&quot;, Date.now())</code>; email <code>chloe{{rand}}@example.com</code> ; tests : <strong>201</strong>, <code>Location</code>, sauvegarde <code>userId</code>.</li>
<li><code>GET {{baseUrl}}/users/{{userId}}</code> â€” tests : 200, id Ã©gal.</li>
<li><code>PUT {{baseUrl}}/users/{{userId}}</code> â€” Body avec nom/email/role ; tests : 200, nom mis Ã  jour.</li>
<li><code>PATCH {{baseUrl}}/users/{{userId}}</code> â€” Body <code>{ &quot;role&quot;: &quot;admin&quot; }</code> ; tests : 200, rÃ´le = admin.</li>
<li><code>DELETE {{baseUrl}}/users/{{userId}}</code> â€” tests : <strong>204</strong>.</li>
<li>(Optionnel) <code>GET {{baseUrl}}/users/{{userId}}</code> â€” test <strong>404</strong> aprÃ¨s suppression.</li>
</ul>
</li>
<li>
<p><strong>Runner</strong> : exÃ©cuter la collection (POST â†’ GET id â†’ PUT â†’ PATCH â†’ DELETE).</p>
</li>
<li>
<p><strong>Data-driven</strong> : CSV <code>name,email,role</code> et utiliser <code>{{name}}</code>, <code>{{email}}</code>, <code>{{role}}</code> dans le Body du POST.</p>
</li>
</ol>
<p>Exemple :</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csv" data-lang="csv"><span style="display:flex;"><span><span style="color:#e6db74">name</span>,<span style="color:#e6db74">email</span>,<span style="color:#e6db74">role</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">Alice</span>,<span style="color:#e6db74">alice@example.com</span>,<span style="color:#e6db74">student</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">Bob</span>,<span style="color:#e6db74">bob@example.com</span>,<span style="color:#e6db74">teacher</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">Chloe</span>,<span style="color:#e6db74">chloe@example.com</span>,<span style="color:#e6db74">admin</span></span></span></code></pre></div>
<p>RequÃªte POST dans Postman :
URL : <code>POST {{baseUrl}}/api/posts</code></p>
<p>Headers :</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code class="language-pgsql" data-lang="pgsql">Content-Type: application/json</code></pre></div>
<p>Body (raw/JSON) :</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;{{name}}&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;email&#34;</span>: <span style="color:#e6db74">&#34;{{email}}&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;{{role}}&#34;</span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Ici, {{name}}, {{email}} et {{role}} sont des variables de Postman qui seront remplacÃ©es par les valeurs du CSV.</p>
<p>Snippets tests utiles :</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">pm</span>.<span style="color:#a6e22e">test</span>(<span style="color:#e6db74">&#34;200 OK&#34;</span>, () =&gt; <span style="color:#a6e22e">pm</span>.<span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">code</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">200</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">pm</span>.<span style="color:#a6e22e">test</span>(<span style="color:#e6db74">&#34;JSON&#34;</span>, () =&gt; <span style="color:#a6e22e">pm</span>.<span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">headers</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#34;Content-Type&#34;</span>).<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#34;application/json&#34;</span>));
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">pm</span>.<span style="color:#a6e22e">environment</span>.<span style="color:#a6e22e">set</span>(<span style="color:#e6db74">&#34;userId&#34;</span>, <span style="color:#a6e22e">pm</span>.<span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">json</span>().<span style="color:#a6e22e">id</span>);</span></span></code></pre></div>
<h2 id="-Ã -produire">ðŸ“‹ Ã€ produire</h2>
<ol>
<li><strong>Tableau</strong> â€œrequÃªte â†’ rÃ©ponseâ€ pour 6 routes (mÃ©thode, chemin, <strong>code</strong>, en-tÃªtes clÃ©s, corps).</li>
<li><strong>3 captures</strong> onglet <em>Network</em> (annotation : ligne de requÃªte, en-tÃªtes, corps).</li>
<li><strong>3 commandes curl</strong> + sorties.</li>
<li><strong>Export Postman</strong> (collection JSON) ou capture du <strong>Runner</strong> qui passe vert.</li>
</ol>
<h2 id="-bonus-optionnel">â­ Bonus (optionnel)</h2>
<ul>
<li><code>npm i cors</code> puis <code>app.use(require('cors')());</code> â€” tester les en-tÃªtes CORS.</li>
<li>Pagination (<code>GET /users?page=1&amp;limit=5</code>) et tri.</li>
</ul>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          <a id="R-logo" class="R-default" href="/420-514/index.html">
            <div class="logo-title">Collecte et interprÃ©tation de donnÃ©es</div>
          </a>
        </div>
        <search><form action="/420-514/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/420-514/intro/index.html"><a class="padding" href="/420-514/intro/index.html">1. PrÃ©alables</a><ul id="R-subsections-58f2a84c91d5deefe8bdd3a21213404a" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/420-514/nodejsframeworkexpress/index.html"><a class="padding" href="/420-514/nodejsframeworkexpress/index.html">2. Cadriciel (framework) cÃ´tÃ© serveur : Node.js / express</a><ul id="R-subsections-0ef22c48ddd9f1f383c22c15e8abd43a" class="collapsible-menu"></ul></li>
            <li class="parent " data-nav-id="/420-514/httprequestdataformat/index.html"><a class="padding" href="/420-514/httprequestdataformat/index.html">3. RequÃªtes HTTP et format de donnÃ©es</a><ul id="R-subsections-d6ec56fba70521aa4bd5cbcc16874d4b" class="collapsible-menu">
            <li class="" data-nav-id="/420-514/httprequestdataformat/httprequest/index.html"><a class="padding" href="/420-514/httprequestdataformat/httprequest/index.html">ðŸ“˜ RequÃªtes HTTP</a></li>
            <li class="" data-nav-id="/420-514/httprequestdataformat/asyncrequest/index.html"><a class="padding" href="/420-514/httprequestdataformat/asyncrequest/index.html">ðŸŒ RequÃªtes asynchrones</a></li>
            <li class="" data-nav-id="/420-514/httprequestdataformat/dataformat/index.html"><a class="padding" href="/420-514/httprequestdataformat/dataformat/index.html">ðŸ“˜ Manipulation de donnÃ©es</a></li>
            <li class="active " data-nav-id="/420-514/httprequestdataformat/lab1/index.html"><a class="padding" href="/420-514/httprequestdataformat/lab1/index.html">ðŸ§ª Laboratoire : RequÃªtes HTTP &amp; Ã©changes de donnÃ©es avec Node.js/Express</a></li></ul></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
          </ul>
        </div>
<div id="R-footer"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
  <div class="logo-title">Sara Boumehraz</div>
  <br/>
  <img alt="Licence Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" />
</a>
<br>Creative Commons BY-NC-SA</br></div>
      </div>
    </aside>
    <script src="/420-514/js/clipboard/clipboard.min.js?1756903610" defer></script>
    <script src="/420-514/js/perfect-scrollbar/perfect-scrollbar.min.js?1756903610" defer></script>
    <script src="/420-514/js/theme.js?1756903610" defer></script>
  </body>
</html>
