<!DOCTYPE html>
<html lang="fr-ca" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head><script src="/420-514/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=420-514/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.148.2">
    <meta name="generator" content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862">
    <meta name="description" content="Partie 1 : Ajouter des Middlewares pour la Gestion des Erreurs et le Logging Ajouter un Middleware de Logging
Créez un middleware qui enregistre chaque requête reçue par le serveur. Implémentez le code suivant au début de votre fichier index.js : const express = require(&#39;express&#39;); const app = express(); const port = 3000; // Middleware de logging app.use((req, res, next) =&gt; { console.log(`${req.method} ${req.url}`); next(); });Ajouter un Middleware de Gestion des Erreurs
Créez un middleware pour intercepter les erreurs et envoyer une réponse appropriée. Placez ce middleware à la fin de toutes vos routes dans index.js : // Middleware de gestion des erreurs app.use((err, req, res, next) =&gt; { console.error(err.stack); res.status(500).send(&#39;Une erreur est survenue!&#39;); });Partie 2 : Servir des Fichiers Statiques Créer un Dossier public">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Laboratoire : Gestion des Erreurs et Logging :: Collecte et interprétation de données">
    <meta name="twitter:description" content="Partie 1 : Ajouter des Middlewares pour la Gestion des Erreurs et le Logging Ajouter un Middleware de Logging
Créez un middleware qui enregistre chaque requête reçue par le serveur. Implémentez le code suivant au début de votre fichier index.js : const express = require(&#39;express&#39;); const app = express(); const port = 3000; // Middleware de logging app.use((req, res, next) =&gt; { console.log(`${req.method} ${req.url}`); next(); });Ajouter un Middleware de Gestion des Erreurs
Créez un middleware pour intercepter les erreurs et envoyer une réponse appropriée. Placez ce middleware à la fin de toutes vos routes dans index.js : // Middleware de gestion des erreurs app.use((err, req, res, next) =&gt; { console.error(err.stack); res.status(500).send(&#39;Une erreur est survenue!&#39;); });Partie 2 : Servir des Fichiers Statiques Créer un Dossier public">
    <meta property="og:url" content="http://localhost:1313/420-514/nodejsframeworkexpress/lab2/index.html">
    <meta property="og:site_name" content="Collecte et interprétation de données">
    <meta property="og:title" content="Laboratoire : Gestion des Erreurs et Logging :: Collecte et interprétation de données">
    <meta property="og:description" content="Partie 1 : Ajouter des Middlewares pour la Gestion des Erreurs et le Logging Ajouter un Middleware de Logging
Créez un middleware qui enregistre chaque requête reçue par le serveur. Implémentez le code suivant au début de votre fichier index.js : const express = require(&#39;express&#39;); const app = express(); const port = 3000; // Middleware de logging app.use((req, res, next) =&gt; { console.log(`${req.method} ${req.url}`); next(); });Ajouter un Middleware de Gestion des Erreurs
Créez un middleware pour intercepter les erreurs et envoyer une réponse appropriée. Placez ce middleware à la fin de toutes vos routes dans index.js : // Middleware de gestion des erreurs app.use((err, req, res, next) =&gt; { console.error(err.stack); res.status(500).send(&#39;Une erreur est survenue!&#39;); });Partie 2 : Servir des Fichiers Statiques Créer un Dossier public">
    <meta property="og:locale" content="fr_ca">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Cadriciel (framework) côté serveur : Node.js / express">
    <meta itemprop="name" content="Laboratoire : Gestion des Erreurs et Logging :: Collecte et interprétation de données">
    <meta itemprop="description" content="Partie 1 : Ajouter des Middlewares pour la Gestion des Erreurs et le Logging Ajouter un Middleware de Logging
Créez un middleware qui enregistre chaque requête reçue par le serveur. Implémentez le code suivant au début de votre fichier index.js : const express = require(&#39;express&#39;); const app = express(); const port = 3000; // Middleware de logging app.use((req, res, next) =&gt; { console.log(`${req.method} ${req.url}`); next(); });Ajouter un Middleware de Gestion des Erreurs
Créez un middleware pour intercepter les erreurs et envoyer une réponse appropriée. Placez ce middleware à la fin de toutes vos routes dans index.js : // Middleware de gestion des erreurs app.use((err, req, res, next) =&gt; { console.error(err.stack); res.status(500).send(&#39;Une erreur est survenue!&#39;); });Partie 2 : Servir des Fichiers Statiques Créer un Dossier public">
    <meta itemprop="wordCount" content="679">
    <title>Laboratoire : Gestion des Erreurs et Logging :: Collecte et interprétation de données</title><link rel="icon" href="/420-123/images/favicon.png" type="image/png">
    <link href="/420-514/css/auto-complete/auto-complete.min.css?1756297722" rel="stylesheet">
    <script src="/420-514/js/auto-complete/auto-complete.min.js?1756297722" defer></script>
    <script src="/420-514/js/search-lunr.js?1756297722" defer></script>
    <script src="/420-514/js/search.js?1756297722" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/420-514/searchindex.en.js?1756297722";
    </script>
    <script src="/420-514/js/lunr/lunr.min.js?1756297722" defer></script>
    <script src="/420-514/js/lunr/lunr.stemmer.support.min.js?1756297722" defer></script>
    <script src="/420-514/js/lunr/lunr.multi.min.js?1756297722" defer></script>
    <script src="/420-514/js/lunr/lunr.fr.min.js?1756297722" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['fr'];
    </script>
    <link href="/420-514/fonts/fontawesome/css/fontawesome-all.min.css?1756297722" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/420-514/fonts/fontawesome/css/fontawesome-all.min.css?1756297722" rel="stylesheet"></noscript>
    <link href="/420-514/css/perfect-scrollbar/perfect-scrollbar.min.css?1756297722" rel="stylesheet">
    <link href="/420-514/css/theme.css?1756297722" rel="stylesheet">
    <link href="/420-514/css/format-html.css?1756297722" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = ``;
      window.relearn.path='\/nodejsframeworkexpress\/lab2\/index.html';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='http:\/\/localhost:1313\/420-514';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'green' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
  </head>
  <body class="mobile-support html" data-url="/420-514/nodejsframeworkexpress/lab2/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/420-514/index.html"><span itemprop="name">Collecte et interprétation de données</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/420-514/nodejsframeworkexpress/index.html"><span itemprop="name">Cadriciel (framework) côté serveur : Node.js / express</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><span itemprop="name">Laboratoire : Gestion des Erreurs et Logging</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable nodejsframeworkexpress" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="laboratoire--gestion-des-erreurs-et-logging">Laboratoire : Gestion des Erreurs et Logging</h1>

<h3 id="partie-1--ajouter-des-middlewares-pour-la-gestion-des-erreurs-et-le-logging">Partie 1 : Ajouter des Middlewares pour la Gestion des Erreurs et le Logging</h3>
<ol>
<li>
<p><strong>Ajouter un Middleware de Logging</strong></p>
<ul>
<li>Créez un middleware qui enregistre chaque requête reçue par le serveur.</li>
<li>Implémentez le code suivant au début de votre fichier <code>index.js</code> :</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">express</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;express&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">app</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">port</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3000</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Middleware de logging
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>((<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">method</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">url</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>});</span></span></code></pre></div>
</li>
<li>
<p><strong>Ajouter un Middleware de Gestion des Erreurs</strong></p>
<ul>
<li>Créez un middleware pour intercepter les erreurs et envoyer une réponse appropriée.</li>
<li>Placez ce middleware à la fin de toutes vos routes dans <code>index.js</code> :</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#75715e">// Middleware de gestion des erreurs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>((<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">stack</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">500</span>).<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;Une erreur est survenue!&#39;</span>);
</span></span><span style="display:flex;"><span>});</span></span></code></pre></div>
</li>
</ol>
<h3 id="partie-2--servir-des-fichiers-statiques">Partie 2 : Servir des Fichiers Statiques</h3>
<ol>
<li>
<p><strong>Créer un Dossier <code>public</code></strong></p>
<ul>
<li>Créez un dossier <code>public</code> à la racine de votre projet avec la commande suivante :</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir public</span></span></code></pre></div>
</li>
<li>
<p><strong>Ajouter un Fichier HTML dans le Dossier <code>public</code></strong></p>
<ul>
<li>Créez un fichier <code>index.html</code> dans le dossier <code>public</code> avec le contenu suivant :</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;fr&#34;</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;Page d&#39;accueil&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h1</span>&gt;Bienvenue sur mon site!&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">p</span>&gt;Ceci est une page HTML servie par Express.&lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;</span></span></code></pre></div>
</li>
<li>
<p><strong>Configurer Express pour Servir les Fichiers Statiques</strong></p>
<ul>
<li>Ajoutez le code suivant dans votre fichier <code>index.js</code> pour permettre à Express de servir les fichiers du dossier <code>public</code> :</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#75715e">// Servir des fichiers statiques
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">express</span>.<span style="color:#66d9ef">static</span>(<span style="color:#e6db74">&#39;public&#39;</span>));</span></span></code></pre></div>
</li>
</ol>
<h3 id="partie-3--utiliser-la-librairie-de-journalisation-winston">Partie 3 : Utiliser la Librairie de Journalisation <code>Winston</code></h3>
<ol>
<li>
<p><strong>Installer Winston</strong></p>
<ul>
<li>Installez la librairie Winston en exécutant la commande suivante dans votre terminal :</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>npm install winston</span></span></code></pre></div>
</li>
<li>
<p><strong>Configurer Winston</strong></p>
<ul>
<li>Ajoutez le code suivant dans votre fichier <code>index.js</code> pour configurer Winston et l&rsquo;intégrer avec Express pour gérer les logs :</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">winston</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;winston&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Configuration du logger avec Winston
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">logger</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">winston</span>.<span style="color:#a6e22e">createLogger</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">level</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;info&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">format</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">winston</span>.<span style="color:#a6e22e">format</span>.<span style="color:#a6e22e">combine</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">winston</span>.<span style="color:#a6e22e">format</span>.<span style="color:#a6e22e">timestamp</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">winston</span>.<span style="color:#a6e22e">format</span>.<span style="color:#a6e22e">json</span>()
</span></span><span style="display:flex;"><span>  ),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">transports</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">winston</span>.<span style="color:#a6e22e">transports</span>.<span style="color:#a6e22e">Console</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">winston</span>.<span style="color:#a6e22e">transports</span>.<span style="color:#a6e22e">File</span>({ <span style="color:#a6e22e">filename</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;logs/app.log&#39;</span> })
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Middleware de logging utilisant Winston
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>((<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">method</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">url</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>});</span></span></code></pre></div>
</li>
</ol>
<h3 id="partie-4--tester-les-améliorations">Partie 4 : Tester les Améliorations</h3>
<ol>
<li><strong>Test du Middleware de Logging</strong>
<ul>
<li>Lancez votre serveur avec <code>node index.js</code>.</li>
<li>Accédez à différentes routes (par exemple, <code>/</code> ou <code>/info</code>) et vérifiez que les requêtes sont enregistrées dans le terminal et dans le fichier <code>logs/app.log</code>.</li>
</ul>
</li>
<li><strong>Test du Middleware de Gestion des Erreurs</strong>
<ul>
<li>
<p>Créez une route qui lève une exception pour simuler une erreur :</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/cause-error&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;Erreur simulée!&#39;</span>);
</span></span><span style="display:flex;"><span>});</span></span></code></pre></div>
</li>
<li>
<p>Accédez à cette route via <code>GET &lt;http://localhost:3000/cause-error</code>&gt; et observez le message d&rsquo;erreur personnalisé.</p>
</li>
</ul>
</li>
<li><strong>Test de la Servitude des Fichiers Statiques</strong>
<ul>
<li>Accédez à <code>http://localhost:3000/</code> dans votre navigateur pour voir la page HTML servie par Express.</li>
</ul>
</li>
</ol>
<h3 id="partie-5--fichier-indexjs-complet">Partie 5 : Fichier <code>index.js</code> Complet</h3>
<p>Voici un exemple complet après l&rsquo;ajout des middlewares et Winston :</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">express</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;express&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">winston</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;winston&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">app</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">express</span>();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">port</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">3000</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Configuration du logger avec Winston
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">logger</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">winston</span>.<span style="color:#a6e22e">createLogger</span>({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">level</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;info&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">format</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">winston</span>.<span style="color:#a6e22e">format</span>.<span style="color:#a6e22e">combine</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">winston</span>.<span style="color:#a6e22e">format</span>.<span style="color:#a6e22e">timestamp</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">winston</span>.<span style="color:#a6e22e">format</span>.<span style="color:#a6e22e">json</span>()
</span></span><span style="display:flex;"><span>  ),
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">transports</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">winston</span>.<span style="color:#a6e22e">transports</span>.<span style="color:#a6e22e">Console</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">winston</span>.<span style="color:#a6e22e">transports</span>.<span style="color:#a6e22e">File</span>({ <span style="color:#a6e22e">filename</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;logs/app.log&#39;</span> })
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Middleware de logging utilisant Winston
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>((<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">method</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">url</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Servir des fichiers statiques
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>(<span style="color:#a6e22e">express</span>.<span style="color:#66d9ef">static</span>(<span style="color:#e6db74">&#39;public&#39;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Route de base
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;Bienvenue sur mon serveur Express!&#39;</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Route pour afficher un message personnalisé
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/hello/:name&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">params</span>.<span style="color:#a6e22e">name</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">`Bonjour, </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">name</span><span style="color:#e6db74">}</span><span style="color:#e6db74">!`</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Route qui renvoie les informations sur le serveur
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/info&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">json</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">version</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;1.0.0&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Ceci est un serveur simple utilisant Express.js&#39;</span>,
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Route pour simuler une erreur
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/cause-error&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#39;Erreur simulée!&#39;</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Middleware de gestion des erreurs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">use</span>((<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">logger</span>.<span style="color:#a6e22e">error</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">stack</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">status</span>(<span style="color:#ae81ff">500</span>).<span style="color:#a6e22e">send</span>(<span style="color:#e6db74">&#39;Une erreur est survenue!&#39;</span>);
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Démarrer le serveur
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">listen</span>(<span style="color:#a6e22e">port</span>, () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`Serveur en écoute sur &lt;http://localhost&gt;:</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">port</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>});</span></span></code></pre></div>
<h3 id="résultats-attendus">Résultats Attendus</h3>
<ol>
<li><strong>Logging</strong>: Toutes les requêtes HTTP seront enregistrées dans la console et dans le fichier <code>logs/app.log</code>.</li>
<li><strong>Gestion des Erreurs</strong>: En cas d&rsquo;erreur, un message d&rsquo;erreur approprié sera affiché, et les détails seront enregistrés dans les logs.</li>
<li><strong>Servitude de Fichiers Statiques</strong>: La page HTML située dans le dossier <code>public</code> sera servie par Express lorsque l&rsquo;on accède à l&rsquo;URL racine du serveur.</li>
</ol>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          <a id="R-logo" class="R-default" href="/420-514/index.html">
            <div class="logo-title">Collecte et interprétation de données</div>
          </a>
        </div>
        <search><form action="/420-514/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/420-514/intro/index.html"><a class="padding" href="/420-514/intro/index.html">1. Préalables</a><ul id="R-subsections-58f2a84c91d5deefe8bdd3a21213404a" class="collapsible-menu"></ul></li>
            <li class="parent " data-nav-id="/420-514/nodejsframeworkexpress/index.html"><a class="padding" href="/420-514/nodejsframeworkexpress/index.html">2. Cadriciel (framework) côté serveur : Node.js / express</a><ul id="R-subsections-0ef22c48ddd9f1f383c22c15e8abd43a" class="collapsible-menu">
            <li class="" data-nav-id="/420-514/nodejsframeworkexpress/nodejs/index.html"><a class="padding" href="/420-514/nodejsframeworkexpress/nodejs/index.html">NodeJs</a></li>
            <li class="" data-nav-id="/420-514/nodejsframeworkexpress/express/index.html"><a class="padding" href="/420-514/nodejsframeworkexpress/express/index.html">Express</a></li>
            <li class="" data-nav-id="/420-514/nodejsframeworkexpress/lab/index.html"><a class="padding" href="/420-514/nodejsframeworkexpress/lab/index.html">Laboratoire : Commencer avec Node.js et Express.js</a></li>
            <li class="active " data-nav-id="/420-514/nodejsframeworkexpress/lab2/index.html"><a class="padding" href="/420-514/nodejsframeworkexpress/lab2/index.html">Laboratoire : Gestion des Erreurs et Logging</a></li></ul></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
          </ul>
        </div>
<div id="R-footer"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
  <div class="logo-title">Sara Boumehraz</div>
  <br/>
  <img alt="Licence Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" />
</a>
<br>Creative Commons BY-NC-SA</br></div>
      </div>
    </aside>
    <script src="/420-514/js/clipboard/clipboard.min.js?1756297722" defer></script>
    <script src="/420-514/js/perfect-scrollbar/perfect-scrollbar.min.js?1756297722" defer></script>
    <script src="/420-514/js/theme.js?1756297722" defer></script>
  </body>
</html>
